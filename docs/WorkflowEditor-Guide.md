# Workflow Editor ガイド

## 概要

Workflow Editorは、`workflow.json`設定ファイルを視覚的に編集できるGUIツールです。Windows Formsを使用して、ワークフローの基本設定とステップの詳細設定を直感的に編集できます。

## 機能

### 基本設定タブ
- **ワークフロー名**: ワークフローの表示名を設定
- **バージョン**: ワークフローのバージョン番号を管理
- **説明**: ワークフローの説明文を記載
- **設定**: 以下の実行設定を管理
  - 最大リトライ回数（0-10回）
  - リトライ遅延（0-300秒）
  - ログレベル（DEBUG/INFO/WARN/ERROR）
  - 再起動有効化
  - 完了時クリーンアップ

### ステップ設定タブ
- **ステップ一覧表示**: 
  - ナンバリング表示（実行順序）
  - ステップID、名前、説明、スクリプトパス
  - タイプ、管理者権限、再起動必須の状態表示
- **ステップ順序変更**:
  - 「上へ移動」「下へ移動」ボタンで実行順序を調整
  - 移動後も選択状態を維持
- **ステップ詳細編集**:
  - ステップID（読み取り専用）
  - ステップ名と説明
  - スクリプトパス
  - タイプ選択（powershell/batch/internal）
  - 実行オプション（管理者権限、再起動必須）
  - タイムアウト設定（0-7200秒）
  - リトライ回数（0-10回）
  - エラー時の動作（stop/continue/retry）

## 使用方法

### 起動方法
```powershell
# 既定の設定ファイルで起動
.\WorkflowEditor.ps1

# カスタム設定ファイルを指定
.\WorkflowEditor.ps1 -ConfigPath "path\to\custom\workflow.json"
```

### 基本操作

1. **ファイル操作**
   - `Ctrl+O`: 設定ファイルを開く
   - `Ctrl+S`: 現在のファイルに保存
   - メニューまたはボタンから「名前を付けて保存」

2. **基本設定の編集**
   - 基本設定タブで各項目を編集
   - 「基本設定を適用」ボタンで変更を適用
   - 「保存」ボタンでファイルに保存

3. **ステップの編集**
   - ステップ設定タブでステップ一覧を確認
   - ステップを選択すると詳細が下部に表示
   - 詳細を編集後「ステップ設定を適用」ボタンで変更を適用

4. **ステップ順序の変更**
   - ステップを選択
   - 「上へ移動」「下へ移動」ボタンで順序を調整
   - 変更は即座に反映され、選択状態が維持される

### 保存機能

- **保存**: 現在開いているファイルに上書き保存
- **名前を付けて保存**: 新しいファイル名で保存
- **自動バックアップ**: JSONファイルはUTF-8（BOMなし）で保存
- **インデント**: 2スペースインデントで読みやすい形式

## 技術仕様

### 対応環境
- Windows 10/11
- PowerShell 5.1以上
- .NET Framework（Windows Forms）

### ファイル形式
- 入力: JSON形式のワークフロー設定ファイル
- 出力: UTF-8（BOMなし）エンコーディングのJSONファイル
- インデント: 2スペース

### UI設計
- **分割パネル**: 上下分割で一覧と詳細を同時表示
- **リサイズ対応**: ウィンドウサイズに応じてコントロールが自動調整
- **フォーカス管理**: ステップ移動後も選択状態を維持
- **バリデーション**: 数値項目の範囲チェック

## トラブルシューティング

### よくある問題

1. **設定ファイルが見つからない**
   ```
   エラー: 設定ファイルが見つかりません。
   ```
   - 解決方法: `-ConfigPath`パラメータで正しいパスを指定

2. **JSON形式エラー**
   ```
   Failed to load configuration file: ...
   ```
   - 解決方法: JSONファイルの構文を確認、または新しいファイルを作成

3. **フォーム表示エラー**
   ```
   エラー: フォームの作成に失敗しました。
   ```
   - 解決方法: PowerShell 5.1以上とWindows Formsが利用可能か確認

### デバッグ情報

起動時に以下の情報がコンソールに表示されます：
- 設定ファイルの読み込み状況
- フォーム作成状況
- 初期データ読み込み状況

## 注意事項

- **管理者権限**: ファイル保存時に管理者権限が必要な場合があります
- **バックアップ**: 重要な設定ファイルは事前にバックアップを取ってください
- **文字エンコーディング**: UTF-8（BOMなし）で保存されるため、他のエディタとの互換性があります

## 関連ドキュメント

- [ワークフロー設定ガイド](Customization-Guide.md): workflow.jsonの詳細仕様
- [アプリケーション管理ガイド](Application-Management.md): applications.jsonの編集方法
- [トラブルシューティング](Troubleshooting.md): 一般的な問題解決方法
